SK="undefined"==typeof SK?{}:SK,SK.addRecursivelyKOObservables=function(t,e){var i={};for(var n in t)if("object"==typeOf(t[n]))i[n]=SK.addRecursivelyKOObservables(t[n],e);else if("array"==typeOf(t[n])){i[n]=e.observableArray([]);for(var s=0,o=t[n].length;s<o;s++)i[n].push(SK.addRecursivelyKOObservables(t[n][s],e))}else i[n]=e.observable(e.unwrap(t[n]));return i},SK.updateRecursivelyKOObservables=function(t,e,i){SK._loopRecursivelyKOObservables(t,e,function(n){e[n].removeAll();for(var s=0,o=t[n].length;s<o;s++)e[n].push(SK.addRecursivelyKOObservables(t[n][s],i))},i)},SK.mergeRecursivelyKOObservables=function(t,e,i){SK._loopRecursivelyKOObservables(t,e,function(n){for(var s=0,o=t[n].length;s<o;s++)e[n]()[s]?SK.mergeRecursivelyKOObservables(t[n][s],e[n]()[s],i):e[n].push(SK.addRecursivelyKOObservables(t[n][s],i))},i)},SK._loopRecursivelyKOObservables=function(t,e,i,n){for(var s in t)e&&e.hasOwnProperty(s)&&("object"==typeOf(t[s])?arguments.callee.call(null,t[s],e[s],n):"function"==typeOf(e[s])&&("array"==typeOf(t[s])?i(s):e[s](t[s])))},SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Empty=SK.UI.Element.Empty||function(){},SK="undefined"==typeof SK?{}:SK,SK.Applications=SK.Applications||{},SK.Applications.ContactInfo=SK.Applications.ContactInfo||{},SK.Applications.ContactInfo.OpenHours=SK.Applications.ContactInfo.OpenHours||new Class({elements:{},initialize:function(t){if(this.env=t,!this.env)return this;this.displayOpenHours()},getCurrentDay:function(){var t=(new Date).getDay();return 0==t?6:t-1},displayOpenHours:function(){if(SK.Applications.OpenHours&&SK.Applications.OpenHours.Shared&&SK.Applications.OpenHours.Shared.open_hours&&(this.elements.placeholder=_$(this.env.placeholder),this.elements.open_hours=this.elements.placeholder.getElement(".sk-ci-oh-time-content")),this.elements.open_hours){var t=SK.Applications.OpenHours.Shared.open_hours[this.getCurrentDay()]||{};if(!t.start||!t.end)return;if(this.elements.open_hours.getParent().getParent().removeClass("sk-ci-hidden-element"),"0"==t.status)return void this.elements.open_hours.set("html","Closed");this.elements.open_hours.set("html",t.start+" - "+t.end),SK.Applications.OpenHours.Shared.split_time.toInt()&&t.start_timesplit&&t.end_timesplit&&this.elements.placeholder.getElement(".sk-ci-oh-split-content").set("html",t.start_timesplit+" - "+t.end_timesplit)}}}),SK="undefined"==typeof SK?{}:SK,SK.Applications=SK.Applications||{},SK.Applications.ContactInfo=SK.Applications.ContactInfo||{},SK.Applications.ContactInfo.helpers=SK.Applications.ContactInfo.helpers||{},function(t){t.defaultProperties=[{selected:1,item:"phone"},{selected:1,item:"email"},{selected:1,item:"address"},{selected:0,item:"facebook"},{selected:0,item:"twitter"},{selected:0,item:"linkedin"},{selected:0,item:"google"},{selected:0,item:"pinterest"},{selected:0,item:"openhours"},{selected:0,item:"instagram"},{selected:0,item:"whatsapp"}],t.fieldPlaceholders={phone:"Enter phone...",email:"Enter email...",address:"Enter address..."},t.link_prefix={phone:"tel:",email:"mailto:",google:"https://plus.google.com/",twitter:"https://twitter.com/",instagram:"https://instagram.com/",whatsapp:"https://wa.me/",address:"http://maps.google.com/?q=",facebook:"https://www.facebook.com/",linkedin_personal:"https://www.linkedin.com/in/",linkedin_company:"https://www.linkedin.com/company/",pinterest:"https://www.pinterest.com/"},t.useItemsForGlobalUpdate=["email","address","phone"],t.parseStringJSONAddress=function(t){if(t){try{t=JSON.decode(t)}catch(e){return t}var e="";return Object.each(t,function(t,i){"country"!=i&&(e=e+t+", ")}),e.replace(/,\s$/,"")}return t},t.createLink=function(t,e){var i=t.item,n=t.input;return"address"==i?e[i]+n.replace(/[\s<>\/]/g,"+"):"phone"==i&&n.test(/^tel\:/)||"email"==i&&n.test(/^mailto\:/)?n:"linkedin"==i?("1"==t.is_company?e.linkedin_company:e.linkedin_personal)+n:e[i]+n},t.isOpenHours=function(t){return"openhours"==t},t.getDefaultData=function(t){var e=SK.Singletons.env.getAll();let i={phone:e.user_phone,email:e.user_email,address:SK.Applications.ContactInfo.helpers.parseStringJSONAddress(e.user_address)};for(var n=0,s=t.length;n<s;n++){var o=t[n].item;t[n].icon_src="",t[n].input=i[o]?i[o]:"",t[n].link="",t[n].input&&!SK.Applications.ContactInfo.helpers.isOpenHours(o)&&(t[n].link=SK.Applications.ContactInfo.helpers.createLink(t[n],SK.Applications.ContactInfo.helpers.link_prefix))}return JSON.encode(t)}}(SK.Applications.ContactInfo.helpers),SK="undefined"==typeof SK?{}:SK,SK.Applications=SK.Applications||{},SK.Applications.ContactInfo=SK.Applications.ContactInfo||{},SK.Applications.ContactInfo.Display=SK.Applications.ContactInfo.Display||new Class({Extends:SK.UI.Element.Application.Display,Implements:SK.Applications.ContactInfo.OpenHours,default_property_values:{icon_size:"48",icon_class:"sk-ci-large",display_items_text:"1",last_force_global:1,rearrange_options:0,contact_info:SK.Applications.ContactInfo.helpers.defaultProperties},api:new SK.API,timer:{},callbacks:{},old_instance:!1,is_initial_add:!1,timeout:600,collection:{},link_prefix:SK.Applications.ContactInfo.helpers.link_prefix,data_to_compare:{input:{},selected:{}},is_company_to_compare:"0",link_tooltips:{},icon_id:{phone:"icon2",email:"icon4",google:"icon183",address:"icon53",twitter:"icon181",instagram:"icon188",whatsapp:"icon189",facebook:"icon178",linkedin:"icon185",pinterest:"icon184",openhours:"icon144"},collection_id:{gray:"pictograms_gray",black:"pictograms_black",white:"pictograms_white"},tooltip_option:{show_delay:150,hide_delay:150,class_name:"sk-ci-link-tooltip"},icon_class:{30:"sk-ci-small",40:"sk-ci-medium",48:"sk-ci-large"},are_all_items_disabled:!1,open_hours_app_id:78,isOpenHours:SK.Applications.ContactInfo.helpers.isOpenHours,default_settings_values:{contact_info:JSON.parse(SK.Applications.ContactInfo.helpers.getDefaultData(SK.Applications.ContactInfo.helpers.defaultProperties)),is_first_init:!0,force_global:0},initialize:function(t){if(this.is_admin){if(this.callbacks.setIconsSrc=this.setIconsSrc.bind(this),this.default_property_values.rearrange_options=t.properties.rearrange_options,t.properties.contact_info){this.setOldInstance(JSON.decode(t.properties.contact_info));var e=t.properties.color_scheme}else this.default_property_values.contact_info=SK.Applications.ContactInfo.helpers.getDefaultData(this.default_property_values.contact_info),this.is_initial_add=!0;t.settings=Object.assign({},Object.append({},this.default_settings_values),t.settings)}if(this.parent(t),this.is_admin)return!this.is_initial_add&&this.getImageCollection(this.collection_id[e],e,this.callbacks.setIconsSrc),void this.addLinkTooltips();this.setIconsSrc()},createObservables:function(){this.env.open_hours=this.env.ko.observable(""),this.env.split_time=this.env.ko.observable(""),this.parent();var t=SK.Applications.OpenHours&&SK.Applications.OpenHours.Shared;t&&SK.Applications.OpenHours.Shared.open_hours&&(this.env.open_hours(SK.Applications.OpenHours.Shared.open_hours[this.getCurrentDay()]),this.env.split_time(SK.Applications.OpenHours.Shared.split_time)),"nodejs"==Browser.name&&this.env.open_hours(!this.old_instance),this.setGlobaldata();var e=[...JSON.parse(this.env.properties.contact_info()||""),...this.getUpdatedDefaults()];this.default_property_values.rearrange_options||e.push(...e.splice(e.findIndex(t=>"openhours"==t.item),1)),this.is_admin&&SK.React.Component.Application.GlobalData.addChangeListener(this.liveUpdateData.bind(this,this.env.properties.contact_info())),e=this.updateContactInfoData(e),this.setLinkedinIsCompany(e),this.env.contact_info=SK.addRecursivelyKOObservables({data:e},this.env.ko),this.is_initial_add&&this.initImageCollections(this.callbacks.setIconsSrc),this.env.labels={phone:"Phone",email:"Email",google:"Google+",address:"Address",twitter:"Twitter",instagram:"Instagram",whatsapp:"Whatsapp",facebook:"Facebook",linkedin:"LinkedIn",pinterest:"Pinterest",openhours:"Open Hours"},this.env.is_admin=this.is_admin,this.is_admin&&(this.env.validation_ok=this.env.ko.observable(!0),this.env.destination_index=this.env.ko.observable(-1),this.env.field_placeholders=SK.Applications.ContactInfo.helpers.fieldPlaceholders,this.env.properties.color_scheme.subscribe(this.setIconsSrc,this),this.env.properties.icon_size.subscribe(function(t){this.env.properties.icon_class(this.icon_class[t])},this),this.env.validation_ok.subscribe(this.onInputChange,this),this.env.destination_index.subscribe(this.onDataReordered,this),this.env.contact_info.data().find(t=>"linkedin"==t.item()).is_company.subscribe(()=>{this.onInputChange(this.env.validation_ok())},this),t&&SK.React.Component.Application.GlobalData.addChangeListener(this.onSharedDataChange.bind(this)))},getUpdatedDefaults:function(){let t=JSON.decode(this.env.properties.contact_info()),e=this.default_settings_values.contact_info,i=t.map(t=>t.item);return e.filter(t=>!i.includes(t.item))},createComputed:function(){this.is_admin&&(this.env.computed_contact_info=this.env.ko.computed(function(){return this.env.ko.toJS(this.env.contact_info.data)},this),this.env.computed_contact_info.subscribe(this.onContactInfoChange,this))},beforeStartEdit:function(){!this.is_initial_add&&this.initImageCollections(),this.old_instance&&this.updateOldContactInfo(),this.setDataToCompare(),this.parent()},startEdit:function(){this.parent(),this.is_initial_add&&this.forceStoreDefaultProperties()},finishEdit:function(){this.env.validation_ok()&&this.areAllItemsDisabled()&&(this.preventSave(!0),this.setContentErrorMessage("Please add at least one item.")),!this.isSavePrevented()&&document.activeElement.tagName.test(/iframe/i)&&this.loseFocus(),this.resetIsInitialAdd();var t=this.parent();return!t&&this.are_all_items_disabled&&(this.preventSave(!1),this.setContentErrorMessage("")),t&&this.env.destination_index()>=0&&this.env.destination_index(-1),t},forceStoreDefaultProperties:function(){for(var t in this.env.properties)this.default_property_values[t]&&this.env.properties[t].valueHasMutated();this.forceSave()},resetIsInitialAdd:function(){this.is_initial_add&&(this.is_initial_add=!1)},onSharedDataChange:function(t){if(t==this.open_hours_app_id){var e=SK.React.Component.Application.GlobalData.getAppData(t);this.env.open_hours(e.open_hours[this.getCurrentDay()]),this.env.split_time(e.split_time)}},onDataChange:function(t,e,i){clearTimeout(this.timer[t]),this.timer[t]=setTimeout(i,e)},initImageCollections:function(t){var e=Object.clone(this.collection_id),i=this.env.properties.color_scheme();for(var n in e)e.hasOwnProperty(n)&&!this.collection[n]&&this.getImageCollection(e[n],n,i==n&&t)},getImageCollection:function(t,e,i){this.api.execute("site.stock_images.get_images",{collection_id:t},function(t,e,i,n,s){if(!i)return this.showErrorNotice(n);this.collection[t]=s.images,e&&e()}.bind(this,e,i))},showErrorNotice:function(t){new SK.UI.NoticeBox(t,function(){},{},{},{class:"btn-alert"})},setIconsSrc:function(){for(var t=this.env.properties.color_scheme(),e=this.env.ko.toJS(this.env.contact_info.data()),i=0,n=e.length;i<n;i++){var s=e[i].item;this.is_admin?this.env.contact_info.data()[i].icon_src(this.getIconUrl(t,s)):this.env.contact_info.data()[i].icon_src("stock_image_id://"+this.collection_id[t]+"___"+this.icon_id[s]+"___small")}},getIconUrl:function(t,e){if(this.collection[t])for(var i=0,n=this.collection[t].length;i<n;i++)if(this.icon_id[e]==this.collection[t][i].id)return this.collection[t][i].sizes.small},setDisplayItemsText:function(){for(var t=0,e=this.env.ko.toJS(this.env.contact_info.data()),i=0,n=e.length;i<n;i++)if(this.isItemEnabled(e[i])&&t++,t>3)return void this.env.properties.display_items_text("0");this.env.properties.display_items_text("1")},onInputChange:function(t){if(t)for(var e=this.env.ko.toJS(this.env.contact_info.data()),i=0,n=e.length;i<n;i++){var s=e[i].item,o=e[i].input;if(!this.isOpenHours(s)&&o!=this.data_to_compare.input[s]||"linkedin"==s&&this.is_company_to_compare!=e[i].is_company){var a=0;return"phone"!=s&&"email"!=s&&"address"!=s&&o.test(/\/+/)&&(o=o.replace(/\/$/,"").split("/").pop(),a=this.timeout),this.data_to_compare.input[s]=e[i].input=o,"linkedin"==s&&(this.is_company_to_compare=e[i].is_company),e[i].link=SK.Applications.ContactInfo.helpers.createLink(e[i],this.link_prefix),this.env.properties.contact_info(JSON.encode(e)),this.initLinkTooltip(e[i]),void this.onDataChange(s+"_input",a,SK.mergeRecursivelyKOObservables.bind(this,{data:e},this.env.contact_info,this.env.ko))}}},onContactInfoChange:function(t){if(this.setDisplayItemsText(),this.env.validation_ok())for(var e=0,i=t.length;e<i;e++){var n=t[e],s=this.isOpenHours(n.item),o="1"==n.selected;n.selected!=this.data_to_compare.selected[n.item]&&(this.data_to_compare.selected[n.item]=n.selected,this.env.properties.contact_info(JSON.encode(t)),!s&&o&&this.initLinkTooltip(n))}},onDataReordered:function(t){if(!(t<0)){var e=this.env.ko.toJS(this.env.contact_info.data());this.isOpenHours(e[t].item)||this.initLinkTooltip(e[t])}},initLinkTooltip:function(t){this.isItemEnabled(t)&&this.onDataChange(t.item+"_tooltip",this.timeout,this.createTooltip.bind(this,t))},addLinkTooltips:function(){for(var t=this.env.ko.toJS(this.env.contact_info.data()),e=0,i=t.length;e<i;e++)this.isOpenHours(t[e].item)||this.initLinkTooltip(t[e])},createTooltip:function(t){var e=t.item;this.link_tooltips[e]&&this.link_tooltips[e].destroy();var i=this.env.placeholder.getElement("[rel="+e+"]");if(i){var n="phone"==e||"email"==e?"":"_blank",s='<a href="'+(t.link||"javascript:void(null);")+'" target="'+n+'">'+this.env.labels[e]+"</a>";this.link_tooltips[e]=new SK.UI.Tooltip(i,{text:s,show_delay:this.tooltip_option.show_delay,hide_delay:this.tooltip_option.hide_delay,class_name:this.tooltip_option.class_name,scroll_containers:["container"]})}},setOldInstance:function(t){this.old_instance=t.length&&t[0].label},setLinkedinIsCompany:function(t){var e=t.find(t=>"linkedin"==t.item);e.is_company=e.is_company||"0"},areAllItemsDisabled:function(){for(var t=this.env.ko.toJS(this.env.contact_info.data()),e=0,i=t.length;e<i;e++)if(this.are_all_items_disabled=!this.isItemEnabled(t[e]),!this.are_all_items_disabled)return this.are_all_items_disabled;return this.are_all_items_disabled},isItemEnabled:function(t){return"1"==t.selected&&(t.input||this.isOpenHours(t.item)&&this.env.open_hours())},setDataToCompare:function(){this.env.ko.toJS(this.env.contact_info.data()).each(function(t){this.data_to_compare.input[t.item]=t.input,this.data_to_compare.selected[t.item]=t.selected,this.is_company_to_compare="linkedin"==t.item?t.is_company:this.is_company_to_compare},this)},updateOldContactInfo:function(){this.env.contact_info.data().each(function(t){delete t.label},this),this.env.contact_info.data.push({selected:this.env.ko.observable(0),item:this.env.ko.observable("openhours"),input:this.env.ko.observable(""),link:this.env.ko.observable(""),icon_src:this.env.ko.observable(this.getIconUrl(this.env.properties.color_scheme(),"openhours"))}),this.env.properties.contact_info(JSON.encode(this.env.ko.toJS(this.env.contact_info.data))),this.old_instance=!1},setGlobaldata:function(){(this.env.settings||{}).is_first_init&&this.env.settings.is_first_init()&&(this.env.settings.contact_info(JSON.parse(this.env.properties.contact_info())),this.env.settings.is_first_init(!1))},updateContactInfoData:function(t){return((this.env.settings||{}).force_global||function(){return 0})()<this.env.properties.last_force_global()?t:t.map(t=>SK.Applications.ContactInfo.helpers.useItemsForGlobalUpdate.includes(t.item)?this.env.settings.contact_info().find(e=>e.item==t.item):t)},liveUpdateData:function(t,e,i){if(e!=this.env.app_id)return;this.env.contact_info.data().forEach(e=>{if(!SK.Applications.ContactInfo.helpers.useItemsForGlobalUpdate.includes(e.item()))return;const n=i.contact_info.find(t=>t.item==e.item());if(i.force_global>this.env.properties.last_force_global())e.input(n.input),e.link(n.link),e.selected(n.selected);else{const i=JSON.parse(t).find(t=>t.item==e.item());e.input(i.input),e.link(i.link),e.selected(i.selected)}})}});